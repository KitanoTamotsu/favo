## 　　Lesson13.　randomユーティリティの選択肢を動的に設定する 
#### 開発メモ
### 1.フローデザイン
　・キーワード起動でパラメータによって、登録、編集、表示をそれぞれ処理する
<br>　・登録するURLはSafariから取得する
<br>　　　
<br>　実装で利用した細かな手法
<br>　・PostNotificaftionに2つのパラメータを渡す（標準出力以外の受け渡しとして変数を使う）
<br>　・Randomユーティリティのリストをファイルから読み込み動的に設定する
<br>　
<br>　実装できなかったもの
<br>　・Alfred環境変数で設定したホームディレクトリ'~'がRunScriptでうまく稼働しない。。。
### 2.PostNotificaftionに2つのパラメータを渡す
　AddLisitの流れを見てください（赤いフロー）
<br>　URLをAppendtoFileオブジェクトでテキストファイルに追加した後に、OSXの通知を使って
<br>　メッセージを表示させます
<br>　この際、テキストファイルの場所と追加したページのタイトルを表示させています
<br>　テキストファイルの場所は、AppendtoFileオブジェクトの標準出力なので{query}で受け渡す
<br>　ことができます
<br>　また、追加したページのタイトルは{var:title}という変数で受け渡していますが
<br>　ArgandVarsユーティリティでセットしています
<br>　ArgandVarsユーティリティを開くと、title、{query}の1行が記載されています
<br>　これは、その前のRunScriptオブジェクトの標準出力{query}をワークフローの変数
<br>　{var:title}にセットするという意味です
### 3.Safariで表示しているHPのURLとタイトルを取得する
　Lesson9の手法を使います
<br>　具体的にはosascript命令でアップルスクリプトを動かしています
<br>　タイトル取得用とURL取得用として2つRunScriptを配置しています
<br>　
<br>　タイトル取得部分のosascript命令を例として書いておきます
```
　title=`osascript -e 'tell app "safari" to get the name of the current tab of window 1'`
```
### 4.Randomユーティリティのリストをファイルから読み込み動的に設定する
　黄色い部分のフローです。
<br>　Lesson12のウィキペディアおまかせ表示では、あらかじめリストを準備しましたが、
<br>　今回はファイルから読み込んで動的にセットします
<br>　
<br>　Randomユーティリティを見てください
<br>　Random:としてword from listを設定してWords:の一覧には{query}とあるだけです
<br>　そうです。このオブジェクトの前段のフローであるRunScriptの標準出力にリストを
<br>　書き出してセットするのです
<br>　ではそのRun Scriptを見てみましょう（黄色いRunScriptです）
<br>　
<br>　実はとてもシンプルで、ファイルの内容をechoしているだけです
<br>　こうすることで、ファイルに登録されたテキスト（URL）が全てRandomユーティリティの
<br>　リストにっなるっていう寸法さ
<br>　
<br>　でもなぜか、workflowの環境変数では"~"をセットしてもうまく動きません
<br>　"Users/..."と書けば環境変数でも使えましたが、その場合配布した先の環境では
<br>　ホームディレクトリの名称が私のものとは違うのでうまく動かないでしょう
<br>　仕方なくスクリプトの中で直接"~"を書いています
<br>　
<br>　Randomユーティリティのリスト自体がURLですので、あとはOpenURLオブジェクトで
<br>　表示させればOKです
<br>
#### 背景
　Lesson12のおまかせウィキペディアを作成した際に、ウィキペディアの高度な検索結果を
<br>　表示させたいと思いました
<br>　例えば『ウィキペディアのタイトルに”効果”か”現象”を含む記事を更新が新しい順に検索』
<br>　みたいな。でもこの場合、フィードバックとしてLargeTypeするURLが見ただけではわからず
<br>　あまりふさわしくない感じでした
<br>　そこでこのワークフローを思いつきました
<br>　お気に入りページというか、面白いと思った記事を保存して、後で適当に読むというような
<br>　利用を想定しています
#### 取扱説明
### 機能:
　お気に入りページの登録・ランダム表示
### インストール:
　1.[Alfredworkflow](https://github.com/KitanoTamotsu/favo/releases/download/1.1/Favorite.Pages.alfredworkflow.zip)をダウンロード 
<br>　2.ファイルをダブルクリックしてワークフローに登録
### 使い方:
　キーワード『favo』で起動
<br>　以下のパラメータを指定できます
<br>　パラメータなし　→ 追加したページをランダムに表示
<br>　aもしくはadd 　→ Safariで閲覧しているページをテキストファイルに追加
<br>　eもしくはedit　→ 追加したテキストファイルを表示（リストの修正や削除ができます）
### 動き方：
　1.テキストファイル（~/Documents/Alfred/favo/favolist.txt）にURLを
<br>　　保存します（1行に1URLとして記述）
<br>　2.ファイルの登録内容を読み込みランダム表示

#### 修正履歴
### ver1.1(2021-04-04)：
　シェルスクリプトをbashからzshに変更しました
<br>
<br>
[トップページに戻る](https://kitanotamotsu.github.io/)

